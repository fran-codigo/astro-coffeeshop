---
import { CategorySchema, CategoriesSlugSchema, PostsSchema } from "@/types";

export async function getStaticPaths() {
  const res = await fetch(
    `${import.meta.env.API_URL}/categories?_fields=slug,name`
  );
  const json = await res.json();
  const categories = CategoriesSlugSchema.parse(json);
  return categories.map((category) => ({
    params: { slug: category.slug },
  }));
}

const { slug } = Astro.params;

const catUrl = `${import.meta.env.API_URL}/categories?slug=${slug}`;
const catRes = await fetch(catUrl);
const catJson = await catRes.json();
const category = CategorySchema.parse(catJson[0]);

const postUrl = `${import.meta.env.API_URL}/posts?categories=${category.id}`;
const postRes = await fetch(postUrl);
const postJson = await postRes.json();
const posts = PostsSchema.parse(postJson);

console.log(posts)
---

<h1>Desde categoria</h1>
